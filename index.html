<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monad Token Claim</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { font-family: sans-serif; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        #status { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Monad Token Claim</h1>

    <button id="connectWalletBtn">连接 MetaMask 钱包</button>
    <button id="connectOkxWalletBtn">连接 OKX 钱包</button>
    <div id="walletAddress"></div>

    <button id="checkWhitelistBtn" disabled>检查是否在白名单</button>
    <div id="whitelistStatus"></div>

    <button id="claimTokenBtn" disabled>领取 Token</button>
    <div id="claimStatus"></div>

    <div id="status"></div>

    <script>
        const claimContractAddress = "0x060152dBBEAA5e94D911b5Cc37347e2951f0A06D";
        const claimContractABI = [{"inputs":,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newAmount","type":"uint256"}],"name":"ClaimAmountUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newInterval","type":"uint256"}],"name":"ClaimIntervalUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"TokensClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"bool","name":"status","type":"bool"}],"name":"WhitelistUpdated","type":"event"},{"inputs":[{"internalType":"address","name":"_users","type":"address"}],"name":"addBatchToWhitelist","outputs":,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"addToWhitelist","outputs":,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"canClaim","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":,"name":"claimAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":,"name":"claimInterval","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":,"name":"claimTokens","outputs":,"stateMutability":"nonpayable","type":"function"},{"inputs":,"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":,"name":"getBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"isWhitelisted","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastClaimTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":,"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":,"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"removeFromWhitelist","outputs":,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newAmount","type":"uint256"}],"name":"setClaimAmount","outputs":,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newInterval","type":"uint256"}],"name":"setClaimInterval","outputs":,"stateMutability":"nonpayable","type":"function"},{"inputs":,"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":,"name":"totalClaimed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"whitelist","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":,"name":"withdraw","outputs":,"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}]

        let provider;
        let signer;
        let claimContract;
        let userAddress;
        let currentWallet = null; // 'metamask' 或 'okx'

        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const connectOkxWalletBtn = document.getElementById('connectOkxWalletBtn');
        const walletAddressDiv = document.getElementById('walletAddress');
        const checkWhitelistBtn = document.getElementById('checkWhitelistBtn');
        const whitelistStatusDiv = document.getElementById('whitelistStatus');
        const claimTokenBtn = document.getElementById('claimTokenBtn');
        const claimStatusDiv = document.getElementById('claimStatus');
        const statusDiv = document.getElementById('status');

        connectWalletBtn.addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();
                    walletAddressDiv.innerText = `连接的钱包: MetaMask - ${userAddress}`;
                    claimContract = new ethers.Contract(claimContractAddress, claimContractABI, signer);
                    checkWhitelistBtn.disabled = false;
                    statusDiv.innerText = "MetaMask 钱包已连接。";
                    currentWallet = 'metamask';
                } catch (error) {
                    console.error("连接 MetaMask 钱包失败:", error);
                    statusDiv.innerText = "连接 MetaMask 钱包失败。请检查 MetaMask 是否已安装并解锁。";
                    currentWallet = null;
                }
            } else {
                statusDiv.innerText = "请安装 MetaMask!";
                currentWallet = null;
            }
        });

        connectOkxWalletBtn.addEventListener('click', async () => {
            if (window.okxwallet) {
                try {
                    await window.okxwallet.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.providers.Web3Provider(window.okxwallet);
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();
                    walletAddressDiv.innerText = `连接的钱包: OKX Wallet - ${userAddress}`;
                    claimContract = new ethers.Contract(claimContractAddress, claimContractABI, signer);
                    checkWhitelistBtn.disabled = false;
                    statusDiv.innerText = "OKX 钱包已连接。";
                    currentWallet = 'okx';
                } catch (error) {
                    console.error("连接 OKX 钱包失败:", error);
                    statusDiv.innerText = "连接 OKX 钱包失败。请检查 OKX Wallet 是否已安装并解锁。";
                    currentWallet = null;
                }
            } else {
                statusDiv.innerText = "请安装 OKX Wallet!";
                currentWallet = null;
            }
        });

        checkWhitelistBtn.addEventListener('click', async () => {
            if (!claimContract) {
                statusDiv.innerText = "请先连接钱包。";
                return;
            }
            try {
                const isWhitelisted = await claimContract.isWhitelisted(userAddress);
                whitelistStatusDiv.innerText = `是否在白名单: ${isWhitelisted ? '是' : '否'}`;
                if (isWhitelisted) {
                    claimTokenBtn.disabled = false;
                    statusDiv.innerText = "您的地址在白名单中，可以领取 Token。";
                } else {
                    claimTokenBtn.disabled = true;
                    statusDiv.innerText = "您的地址不在白名单中。";
                }
            } catch (error) {
                console.error("检查白名单失败:", error);
                whitelistStatusDiv.innerText = "检查白名单失败。";
                statusDiv.innerText = "检查白名单失败，请查看控制台错误信息。";
            }
        });

        claimTokenBtn.addEventListener('click', async () => {
            if (!claimContract) {
                statusDiv.innerText = "请先连接钱包。";
                return;
            }
            try {
                statusDiv.innerText = "正在发送领取交易...";
                claimStatusDiv.innerText = "交易正在进行中...";
                const tx = await claimContract.claimTokens();
                statusDiv.innerText = `领取交易已发送，等待确认... (交易哈希: ${tx.hash})`;
                const receipt = await tx.wait();
                statusDiv.innerText = "领取成功!";
                claimStatusDiv.innerText = `交易已确认 (区块号: ${receipt.blockNumber})`;
            } catch (error) {
                console.error("领取 Token 失败:", error);
                statusDiv.innerText = "领取 Token 失败。请查看控制台错误信息。";
                claimStatusDiv.innerText = "领取失败。";
            }
        });
    </script>
</body>
</html>
