<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monad Token Claim</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
    <style>
        body { font-family: sans-serif; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        #status { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Monad Token Claim</h1>

    <button id="connectWalletBtn">连接 MetaMask 钱包</button>
    <div id="walletAddress"></div>

    <button id="checkWhitelistBtn" disabled>检查是否在白名单</button>
    <div id="whitelistStatus"></div>

    <button id="claimTokenBtn" disabled>领取 Token</button>
    <div id="claimStatus"></div>

    <div id="status"></div>

    <script>
        const claimContractAddress = "0x060152dBBEAA5e94D911b5Cc37347e2951f0A06D";
        // **请在此处替换为你的 Claim 合约的完整 ABI**
        const claimContractABI = [
            // { "inputs":, "name": "claim", "outputs":, "stateMutability": "nonpayable", "type": "function" },
            // { "inputs": [ { "internalType": "address", "name": "account", "type": "address" } ], "name": "isWhitelisted", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" }
            // ... 完整的 ABI ...
        ];

        let provider;
        let signer;
        let claimContract;
        let userAddress;

        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const walletAddressDiv = document.getElementById('walletAddress');
        const checkWhitelistBtn = document.getElementById('checkWhitelistBtn');
        const whitelistStatusDiv = document.getElementById('whitelistStatus');
        const claimTokenBtn = document.getElementById('claimTokenBtn');
        const claimStatusDiv = document.getElementById('claimStatus');
        const statusDiv = document.getElementById('status');

        connectWalletBtn.addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();
                    walletAddressDiv.innerText = `连接的钱包地址: ${userAddress}`;
                    claimContract = new ethers.Contract(claimContractAddress, claimContractABI, signer);
                    checkWhitelistBtn.disabled = false;
                    statusDiv.innerText = "钱包已连接。";
                } catch (error) {
                    console.error("连接钱包失败:", error);
                    statusDiv.innerText = "连接钱包失败。请检查 MetaMask 是否已安装并解锁。";
                }
            } else {
                statusDiv.innerText = "请安装 MetaMask!";
            }
        });

        checkWhitelistBtn.addEventListener('click', async () => {
            if (!claimContract) {
                statusDiv.innerText = "请先连接钱包。";
                return;
            }
            try {
                // **请确保你的合约 ABI 中包含名为 'isWhitelisted' 的函数**
                const isWhitelisted = await claimContract.isWhitelisted(userAddress);
                whitelistStatusDiv.innerText = `是否在白名单: ${isWhitelisted ? '是' : '否'}`;
                if (isWhitelisted) {
                    claimTokenBtn.disabled = false;
                    statusDiv.innerText = "您的地址在白名单中，可以领取 Token。";
                } else {
                    claimTokenBtn.disabled = true;
                    statusDiv.innerText = "您的地址不在白名单中。";
                }
            } catch (error) {
                console.error("检查白名单失败:", error);
                whitelistStatusDiv.innerText = "检查白名单失败。";
                statusDiv.innerText = "检查白名单失败，请查看控制台错误信息。";
            }
        });

        claimTokenBtn.addEventListener('click', async () => {
            if (!claimContract) {
                statusDiv.innerText = "请先连接钱包。";
                return;
            }
            try {
                statusDiv.innerText = "正在发送领取交易...";
                claimStatusDiv.innerText = "交易正在进行中...";
                // **请确保你的合约 ABI 中包含名为 'claim' 的函数**
                const tx = await claimContract.claim();
                statusDiv.innerText = `领取交易已发送，等待确认... (交易哈希: ${tx.hash})`;
                const receipt = await tx.wait();
                statusDiv.innerText = "领取成功!";
                claimStatusDiv.innerText = `交易已确认 (区块号: ${receipt.blockNumber})`;
            } catch (error) {
                console.error("领取 Token 失败:", error);
                statusDiv.innerText = "领取 Token 失败。请查看控制台错误信息。";
                claimStatusDiv.innerText = "领取失败。";
            }
        });
    </script>
</body>
</html>
